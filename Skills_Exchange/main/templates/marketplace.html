{% extends "base.html" %}
{% load static %}

{% block title %}Skill Marketplace | SkillSwap{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
<style>
    .custom { margin: 20px 0px !important; }
    .active { color: white !important; }
    .link { color: #4361ee !important; }

    .skills-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
        gap: 20px;
    }


    .filters-sidebar {
        position: sticky;
        top: 90px;
    }

    .category-link.active {
        background-color: #2563eb;
        color: white !important;
        font-weight: 600;
        box-shadow: 0 2px 6px rgba(37, 99, 235, 0.3);
    }
    .skill-card {
  transition: all 0.3s ease;
  border-radius: 15px;
  background: #fff;
}

.skill-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 6px 20px rgba(37, 99, 235, 0.1);
}

.skill-card .btn-primary {
  background: #2563eb;
  border: none;
  transition: 0.3s ease;
}

.skill-card .btn-primary:hover {
  background: #1e40af;
  box-shadow: 0 4px 10px rgba(37, 99, 235, 0.3);
}

</style>
{% endblock %}

{% block content %}
<section class="marketplace-hero py-5 text-center bg-light">
    <div class="container">
        <h1 class="fw-bold">Discover Skill Collaborations</h1>
        <p class="text-muted">
            Exchange skills, connect with others, and collaborate creatively — no money involved!
        </p>
    </div>
</section>

<div class="container py-4">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 filters-sidebar">
            <div class="filter-section mb-4">
                <h3>Categories</h3>
                <ul class="list-unstyled">
                    <li>
                        <input type="radio" id="cat-all" name="category"
                               {% if not request.GET.category %}checked{% endif %}
                               onchange="applyFilters('all','{{ request.GET.level|default:'' }}')">
                        <label for="cat-all">All</label>
                    </li>
                    {% for category in categories %}
                    <li>
                        <input type="radio" id="cat{{ category.id }}" name="category"
                               value="{{ category.id }}"
                               {% if request.GET.category == category.id|stringformat:'s' %}checked{% endif %}
                               onchange="applyFilters('{{ category.id }}','{{ request.GET.level|default:'' }}')">
                        <label for="cat{{ category.id }}">{{ category.name }}</label>
                    </li>
                    {% empty %}
                    <li class="text-muted">No categories found.</li>
                    {% endfor %}
                </ul>
            </div>

            <div class="filter-section">
                <h3>Skill Level</h3>
                <ul class="list-unstyled">
                    {% for lvl in levels %}
                    <li>
                        <input type="radio" id="level-{{ lvl|lower }}" name="level"
                               value="{{ lvl }}"
                               {% if selected_level|lower == lvl|lower %}checked{% endif %}
                               onchange="applyFilters('{{ request.GET.category|default:'all' }}','{{ lvl }}')">
                        <label for="level-{{ lvl|lower }}">{{ lvl }}</label>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div> <!-- ✅ Properly close sidebar column -->

        <!-- Skills -->
        <div class="col-md-9">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2>{{ skills|length }} Skills Available</h2>
            </div>

            <div class="skills-grid">
                {% for uskill in skills %}
  <div class="card shadow-sm border-0 skill-card mb-4">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5 class="card-title text-primary fw-bold mb-0">
        {{ uskill.skill.name }}
      </h5>
      <span class="badge bg-light text-dark border">{{ uskill.get_proficiency_display }}</span>
    </div>

    <p class="text-muted mb-1">
      <i class="fas fa-layer-group me-2 text-secondary"></i>{{ uskill.skill.category.name }}
    </p>

    <p class="text-muted mb-1">
      <i class="fas fa-briefcase me-2 text-secondary"></i>
      {{ uskill.experience_years }} year{{ uskill.experience_years|pluralize }} experience
    </p>

    <p class="mt-3 mb-3 small">
      <i class="fas fa-user-circle me-2 text-secondary"></i>
      By
      <a href="{% url 'profile' uskill.user.id %}" class="fw-semibold text-decoration-none text-dark">
        {{ uskill.user.userprofile.full_name|default:uskill.user.username }}
      </a>
    </p>

    <div class="text-end">
      <a href="{% url 'propose_exchange' uskill.id %}" class="btn btn-primary px-4 py-2 fw-semibold rounded-pill">
        <i class="fas fa-exchange-alt me-2"></i>Propose Exchange
      </a>
    </div>
  </div>
</div>


                {% empty %}
                <p class="text-muted">No skills found matching your filters.</p>
                {% endfor %}
            </div>
        </div> <!-- ✅ Close main column -->
    </div> <!-- ✅ Close row -->
</div> <!-- ✅ Close container -->

<script>
function applyFilters(category, level) {
    let url = '?';
    if (category && category !== 'all') url += 'category=' + category + '&';
    if (level && level !== 'Any') url += 'level=' + level;
    window.location = url;
}
</script>
{% endblock %}
